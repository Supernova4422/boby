FROM golang:1.15

ARG project_path=/src

COPY . ${project_path}
WORKDIR ${project_path}

RUN go get -d -v ./...
RUN go install -v ./...

RUN apt-get -y update
RUN apt-get -y install gdebi wget
# ARG wkhtmltox=https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox_0.12.6-1.buster_amd64.deb
ARG wkhtmltox=https://github.com/wkhtmltopdf/packaging/releases/download/0.12.6-1/wkhtmltox_0.12.6-1.raspberrypi.buster_armhf.deb
RUN wget -O wkhtmltox.deb ${wkhtmltox}
RUN gdebi --n wkhtmltox.deb

CMD "go" "test" "-v" "./..." "-args" "$config_path"
